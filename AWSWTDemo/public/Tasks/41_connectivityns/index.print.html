<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.123.8">
    <meta name="generator" content="Relearn 5.19.0+tip">
    <meta name="description" content="FortiGate auto-scale and AWS GWLB">
    <meta name="author" content="Fabio Gallego - Cloud CSE">
    <title>3.1 Connectivity: North-South :: FortiGate auto-scale and AWS GWLB</title>
    <link href="https://fortilatam.github.io/tasks/41_connectivityns.html" rel="canonical" type="text/html" title="3.1 Connectivity: North-South :: FortiGate auto-scale and AWS GWLB">
    <link href="/tasks/41_connectivityns/index.xml" rel="alternate" type="application/rss+xml" title="3.1 Connectivity: North-South :: FortiGate auto-scale and AWS GWLB">
    <link href="/images/logo.svg?1710878531" rel="icon" type="image/svg+xml">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/css/fontawesome-all.min.css?1710878532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1710878532" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1710878532" rel="stylesheet">
    <link href="/css/auto-complete.css?1710878532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1710878532" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1710878532" rel="stylesheet">
    <link href="/css/fonts.css?1710878532" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1710878532" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1710878532" rel="stylesheet">
    <link href="/css/theme-Workshop.css?1710878532" rel="stylesheet" id="variant-style">
    <link href="/css/variant.css?1710878532" rel="stylesheet">
    <link href="/css/print.css?1710878532" rel="stylesheet" media="print">
    <link href="/css/format-print.css?1710878532" rel="stylesheet">
    <link href="/css/ie.css?1710878532" rel="stylesheet">
    <script src="/js/url.js?1710878532"></script>
    <script src="/js/variant.js?1710878532"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/fortilatam.github.io/';
      window.variants && variants.init( [ 'Workshop' ] );
    </script><style>
  :root {
     
    --fortinet-white: 255, 255, 255;
    --fortinet-black: 0, 0, 0;
    --fortinet-red: 218, 41, 28;
    --fortinet-blue: 48, 127, 226;
    --fortinet-green: 72, 213, 151;
    --fortinet-teel: 44, 204, 211;
    --fortinet-purple: 144, 99, 205;
    --fortinet-silver: 162, 178, 200;
    --fortinet-silver-jeffMAC: 159, 178, 199;
    --fortinet-silver70: 77, 92, 102;
    --fortinet-lightgray: 228, 228, 228;
    --fortinet-gray: 179, 179, 179;

    --PRIMARY-color: rgb(var(--theme-color)) !important;
    --MAIN-BG-color: rgb(var(--fortinet-white)) !important;
    --MAIN-TEXT-color: rgb(var(--fortinet-black)) !important;
    --MAIN-font: inter, sans-serif;

    --MAIN-LINK-color: #1C90F3 !important;
     
    --LINK-HOVER-color: #167ad0 !important;
     

    --MENU-SECTIONS-ACTIVE-BG-color: rgb(var(--fortinet-black)) !important;
    --MENU-SECTIONS-BG-color: #312525;
     
    --MENU-SECTIONS-LINK-color: #ccc !important;
    --MENU-SECTIONS-LINK-HOVER-color: #e6e6e6 !important;
     
    --MENU-SECTION-ACTIVE-CATEGORY-color: #777;
     
    --MENU-SECTION-ACTIVE-CATEGORY-BG-color: #fff;
     

    --MENU-HEADER-BG-color: rgb(var(--theme-color)) !important;
    --MENU-SEARCH-color: rgba(var(--fortinet-white)) !important;
    --MENU-VISITED-color: rgb(var(--theme-color)) !important;

     
    --MENU-HOME-LINK-color: #ccc !important;
     
    --MENU-HOME-LINK-HOVER-color: rgba(var(--fortinet-white)) !important;
     

     
    --BOX-WARNING-color: rgb(var(--fortinet-red)) !important;
    --BOX-NOTE-color: rgb(var(--fortinet-teel)) !important;
    --BOX-TIP-color: rgb(var(--fortinet-green)) !important;
    --BOX-INFO-color: rgb(var(--fortinet-blue)) !important;

     
    --CODE-BLOCK-color: #e2e4e5 !important;
     
    --CODE-BLOCK-BG-color: rgb(var(--fortinet-gray)) !important;
     
    --CODE-BLOCK-BORDER-color: #282a36 !important;
     

     
    --CODE-INLINE-color: #5e5e5e !important;
     
    --CODE-INLINE-BG-color: #fffae9 !important;
     
    --CODE-INLINE-BORDER-color: #f8e8c8 !important;
     

    --BROWSER-theme: light;
     
    --MERMAID-theme: default;
     
    --SWAGGER-theme: light;
     
  }

  ::placeholder {
     
    color: rgb(var(--fortinet-white)) !important;
    opacity: 1;
     
  }

  :-ms-input-placeholder {
     
    color: rgb(var(--fortinet-white)) !important;
  }

  ::-ms-input-placeholder {
     
    color: rgb(var(--fortinet-white)) !important;
  }

  #title {
    font-size: 1.5rem;
    color: rgb(var(--fortinet-white)) !important;
  }

  #subtitle {
    font-size: 1rem;
     
    color: rgb(var(--fortinet-white)) !important;
  }

  #sidebar .searchbox> :first-child,
  #sidebar .searchbox button,
  .searchbox span {
    opacity: 1;
  }

  .searchbox {
    border: 1px solid rgba(var(--theme-color), .85) !important;
  }

  .searchbox input {
    background: rgba(var(--theme-color), .75) !important;
  }

  #header #logo {
    display: flex;
    justify-content: space-around;
    flex-direction: column;
  }

  @media screen and (min-width: 1300px) {

     
    #body .flex-block-wrapper {
      margin-left: auto;
      margin-right: auto;
      max-width: 1300px;
      width: 100%;
    }
  }
</style>
  </head>
  <body class="mobile-support print" data-url="/tasks/41_connectivityns.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">1. Introduction</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/tasks.html"><span itemprop="name">3. Tasks</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">3.1 Connectivity: North-South</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="31-connectivity-north-south">3.1 Connectivity: North-South</h1>

<p>When using FortiGate with GWLB you can save money and not using <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html" target="_blank">NAT Gateways</a>. NAT GW&rsquo;s are charge for hour and usage, with the scenario you have here, the FortiGate can be your NAT Gateway for all the VPCs connected.</p>
<p>NAT Gateways are used by private instances, what I mean is, the instances that don&rsquo;t have public IPs. Instances that have public IP use IGW (Internet Gateway) to go to internet.</p>
<p>In this first lab, we will see an instance with public IP going to internet using FortiGate public IP and other instance going with its own IP, but with the traffic being inspected by FortiGate.</p>
<ol>
<li>
<p>In AWS console, go to EC2 menu and click on &ldquo;Instances&rdquo;</p>
</li>
<li>
<p>Click &ldquo;wk-spk1-pub-a&rdquo; and then click &ldquo;Connect&rdquo;

<a href="#image-444ceb4f098fd503cf4fcbe1228ff255" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image1.png" alt="4 image1" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-444ceb4f098fd503cf4fcbe1228ff255">
<img src="/tasks/41_connectivityns.html/4_image1.png" alt="4 image1" class="lightbox-image" loading="lazy">
</a></p>
</li>
<li>
<p>Click &ldquo;EC2 serial console&rdquo; and then &ldquo;Connect&rdquo;

<a href="#image-af1707fdf663e4cbbbe84943226309eb" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image2.png" alt="4 image2" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-af1707fdf663e4cbbbe84943226309eb">
<img src="/tasks/41_connectivityns.html/4_image2.png" alt="4 image2" class="lightbox-image" loading="lazy">
</a></p>
</li>
<li>
<p>The login information is:</p>
</li>
</ol>
<p>user: <strong><code>student</code></strong>
password: <strong><code>F0rt1n3t</code></strong></p>
<ol start="5">
<li>
<p>Leave this console tab opened. Repeat the same process with the instance &ldquo;wk-spk2-pub-a&rdquo;</p>
</li>
<li>
<p>In both consoles run the command:</p>
</li>
</ol>
<p><strong><code>curl icanhazip.com</code></strong></p>
<ol start="7">
<li>
<p>This command let us know with which public IP this instance is accessing internet. You will see that the IP is different between <strong>wk-spk2-pub-a</strong> and <strong>wk-spk1-pub-a</strong>. This is happening because one instance (<strong>wk-spk2-pub-a</strong>) is going to the internet using its own public IP and the other instance is using FortiGate&rsquo;s IP.</p>
</li>
<li>
<p>Leave these console tabs opened</p>
</li>
<li>
<p>Go back to AWS console and check the public IPs:</p>
</li>
</ol>
<p>
<a href="#image-af170923075075d716c48b8aca2c1899" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image3.png" alt="4 image3" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-af170923075075d716c48b8aca2c1899">
<img src="/tasks/41_connectivityns.html/4_image3.png" alt="4 image3" class="lightbox-image" loading="lazy">
</a>

<a href="#image-18ccbe4a85e61a0136d12db40a587650" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image4.png" alt="4 image4" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-18ccbe4a85e61a0136d12db40a587650">
<img src="/tasks/41_connectivityns.html/4_image4.png" alt="4 image4" class="lightbox-image" loading="lazy">
</a></p>
<ol start="10">
<li>Check the FortiGate. To see the FortiGate public IP, select the FortiGate, then click &ldquo;Networking&rdquo; tab and scroll down:</li>
</ol>
<p>
<a href="#image-e230597a525f2235cdcb6e01abfa90d8" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image5.png" alt="4 image5" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e230597a525f2235cdcb6e01abfa90d8">
<img src="/tasks/41_connectivityns.html/4_image5.png" alt="4 image5" class="lightbox-image" loading="lazy">
</a></p>
<ol start="11">
<li>Copy this IP and in a new browser tab, paste it to access FortiGate GUI.</li>
<li>FortiGate credentials are in Sharepoint page</li>
<li>After you logged into FortiGate, check the &ldquo;Policy Routes&rdquo;. You will see we have a policy route for all <strong>&ldquo;spoke2-sub-pub1-a&rdquo;</strong> subnet, that is the subnet from <strong>wk-spk2-pub-a</strong></li>
</ol>
<p>
<a href="#image-92176678e8a32bf78688d62dd743e322" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image6.png" alt="4 image6" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-92176678e8a32bf78688d62dd743e322">
<img src="/tasks/41_connectivityns.html/4_image6.png" alt="4 image6" class="lightbox-image" loading="lazy">
</a></p>
<ol start="14">
<li>You can run a sniffer to see the traffic from both instances (<strong>wk-spk2-pub-a</strong> and <strong>wk-spk1-pub-a</strong>) being inspect by FortiGate. Open the FortiGate CLI Console and paste the command below:</li>
</ol>
<p><strong><code>diag sniffer packet any 'host 8.8.8.8' 4</code></strong></p>
<ol start="15">
<li>Leave it running and go to the console tab of one EC2 instance. Then type:</li>
</ol>
<p><strong><code>ping 8.8.8.8</code></strong></p>
<ol start="16">
<li>Go back to FortiGate and see it in the console

<a href="#image-af359b73fddc367c745e5b38db70e4d4" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image7.png" alt="4 image7" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-af359b73fddc367c745e5b38db70e4d4">
<img src="/tasks/41_connectivityns.html/4_image7.png" alt="4 image7" class="lightbox-image" loading="lazy">
</a></li>
<li>Go back to the same EC2 instance console and stop the ping command.</li>
<li>Repeat the ping command in the other EC2 instance console. You will see FortiGate is inspecting it as well.</li>
<li>You are free to change FortiGate firewall policy to perform some different tests</li>
</ol>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p><strong>If you change FortiGate firewall policy, remember to leave it as it was when you accessed or your next labs may not work</strong></p>
</div>
</div>
<p>This is FortiGate security policy default:

<a href="#image-0121e63d3d6d67cadb8b15ac49bead5f" class="lightbox-link">
<img src="/tasks/41_connectivityns.html/4_image8.png" alt="4 image8" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-0121e63d3d6d67cadb8b15ac49bead5f">
<img src="/tasks/41_connectivityns.html/4_image8.png" alt="4 image8" class="lightbox-image" loading="lazy">
</a></p>

            <footer class="footline">

            </footer>
          </article>

        </div>
      </main>
    </div>
    <script src="/js/clipboard.min.js?1710878532" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1710878532" defer></script>
    <script src="/js/theme.js?1710878532" defer></script>
  </body>
</html>
